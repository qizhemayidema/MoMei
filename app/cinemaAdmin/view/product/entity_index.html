{include file="common/source"}
<script src="__STATIC__/js/plugins/treeview/bootstrap-treeview.js"></script>

<script src="__STATIC__/js/plugins/summernote/summernote.min.js"></script>
<script src="__STATIC__/js/plugins/summernote/summernote-zh-CN.js"></script>
<link rel="stylesheet" href="__STATIC__/css/plugins/summernote/summernote.css">
<link rel="stylesheet" href="__STATIC__/css/plugins/summernote/summernote-bs3.css">

<link href="__STATIC__/css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="__STATIC__/css/plugins/fullcalendar/fullcalendar.css" rel="stylesheet">
<link href="__STATIC__/css/plugins/fullcalendar/fullcalendar.print.css" rel="stylesheet">

<!-- iCheck -->
<script src="__STATIC__/js/plugins/iCheck/icheck.min.js"></script>

<!-- Full Calendar -->
<script src="__STATIC__/js/plugins/fullcalendar/fullcalendar.min.js"></script>

<!--<script src="__STATIC__/js/demo/treeview-demo.js"></script>-->
<div class="col-sm-12">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <div class="col-sm-3">
                <div class="">
                    <div id="treeview1" class="test"></div>
                </div>
            </div>
            <div class="col-sm-9" id="container">

            </div>

        </div>
    </div>
</div>
<script>

    function getHtml (id)
    {
        $.ajax({
            url:"{:url('getEntityHtml')}",
            data:{
                id : id
            },
            type:'post',
            dataType:'html',
            success:function(data) {
                // console.log(data)
                $('#container').html(data)
            }
        })
    }

    $(function(){
        $.ajax({
            url:"{:url('getEntityList')}",
            type:'post',
            data:{
                id : "{$id}",
            },
            dataType:'json',
            success:function(data)
            {
                var defaultData = [];

                $(data.data).each(function(k,v){
                    defaultData.push({
                        text: v.entity_name,
                        href: '#parent1',
                        // tags: ['4'],
                        id : v.id,
                    })
                })

                $('#treeview1').treeview({
                    data: defaultData,
                    onNodeSelected: function(event, data) {
                        console.log(data)
                        getHtml(data.id)
                    }
                });

                console.log(data);
            }
        })

    })


    var removeArticle = function (_this, article_id) {
        $.ajax({
            url: "{:url('delete')}",
            type: 'post',
            dataType: 'json',
            data:{
                cate_id : article_id,
            },
            success: function (data) {
                console.log(data)
                if (data.code == 0) {
                    layer.msg(data.msg,{icon: 5})
                } else {
                    layer.msg('删除成功',{icon : 1})
                    $(_this).parents('tr').remove();
                }

            }
        })
    }
</script>